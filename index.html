<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Overview</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="public/css/index.css" />
    <style>
      html[dir="rtl"] .sidebar {
        right: 0;
        left: auto;
        border-left: 2px solid #e5e5e5;
        border-right: none;
      }
      html[dir="rtl"] .header {
        right: var(--sidebar-width);
        left: auto;
      }
      html[dir="rtl"] .main-container {
        margin-right: var(--sidebar-width);
        margin-left: 0;
      }
      /* Dropdown menu styling */
      .dropdown-menu {
        right: 0;
        left: auto;
      }
      /* Language button styling */
      .language-btn {
        width: 36px;
        height: 36px;
        border-radius: 10px;
        background-color: #eee;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #444;
        font-weight: 500;
        font-size: 14px;
        border: none;
        outline: none;
        cursor: pointer;
        margin-right: 10px;
      }
    </style>
  </head>
  <body>
    <div class="sidebar">
      <div class="logo">
        <img
          src="public/images/icon.png"
          alt="Logo"
          style="width: 80px; height: auto"
        />
      </div>
      <div style="margin-bottom: 20px">
        <div class="sidebar-header">Dashboards</div>
        <a href="index.html" class="nav-item active">
          <i class="fas fa-chart-pie"></i> Overview
        </a>
        <a href="users/index.html" class="nav-item">
          <i class="fas fa-users"></i> Users
        </a>
        <a href="subscriptions/index.html" class="nav-item">
          <i class="fas fa-credit-card"></i> Subscriptions
        </a>
        <a href="pricing/index.html" class="nav-item">
          <i class="fas fa-dollar-sign"></i> Pricing
        </a>
        <a href="upload_video/index.html" class="nav-item">
          <i class="fas fa-upload"></i> Videos (Training)
        </a>
      </div>
    </div>

    <div
      class="header d-flex justify-content-between align-items-center px-3 py-2"
    >
      <div class="user-role">Home</div>
      <div class="header-right d-flex align-items-center">
        <button class="language-btn" id="languageBtn">AR</button>
        <div class="dropdown">
          <button
            class="btn btn-link text-decoration-none"
            id="userDropdown"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <span class="admin-label">Admin</span>
            <i class="fas fa-caret-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="userDropdown">
            <li><a class="dropdown-item" href="#" id="logoutBtn">Logout</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="main-container">
      <div class="cards-container">
        <div class="overview-title">Overview</div>
        <div class="row g-4 mb-3">
          <div class="col-12 col-sm-6 col-md-4">
            <div class="overview-card">
              <h5>$0</h5>
              <p>Annual Sales</p>
            </div>
          </div>
          <div class="col-12 col-sm-6 col-md-4">
            <div class="overview-card">
              <h5>$0</h5>
              <p>Monthly Sales</p>
            </div>
          </div>
          <div class="col-12 col-sm-6 col-md-4">
            <div class="overview-card">
              <h5>$0</h5>
              <p>Daily Sales</p>
            </div>
          </div>
        </div>
        <div class="row g-4">
          <div class="col-12 col-sm-6 col-md-4">
            <div class="overview-card">
              <h5>0</h5>
              <p>Number of Users</p>
            </div>
          </div>
          <div class="col-12 col-sm-6 col-md-4">
            <div class="overview-card">
              <h5>0</h5>
              <p>Number of Admins</p>
            </div>
          </div>
          <div class="col-12 col-sm-6 col-md-4">
            <div class="overview-card">
              <h5>0</h5>
              <p>Number of Subscriptions</p>
            </div>
          </div>
        </div>
        <hr class="cards-divider" />
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <script>
      function handleUnauthorized(response) {
        if (response.status === 401) {
          localStorage.removeItem("token");
          window.location.href = "login.html";
          return true;
        }
        return false;
      }

      document.getElementById("logoutBtn").addEventListener("click", (e) => {
        e.preventDefault();
        localStorage.removeItem("token");
        window.location.href = "login.html";
      });

      const languageBtn = document.getElementById("languageBtn");
      let currentLang = "en";
      const translations = {
        en: {
          Home: "Home",
          Overview: "Overview",
          "Annual Sales": "Annual Sales",
          "Monthly Sales": "Monthly Sales",
          "Daily Sales": "Daily Sales",
          "Number of Users": "Number of Users",
          "Number of Admins": "Number of Admins",
          "Number of Subscriptions": "Number of Subscriptions",
          Dashboards: "Dashboards",
          Users: "Users",
          Subscription: "Subscription",
          Admin: "Admin",
        },
        ar: {
          Home: "الرئيسية",
          Overview: "نظرة عامة",
          "Annual Sales": "المبيعات السنوية",
          "Monthly Sales": "المبيعات الشهرية",
          "Daily Sales": "المبيعات اليومية",
          "Number of Users": "عدد المستخدمين",
          "Number of Admins": "عدد المشرفين",
          "Number of Subscriptions": "عدد الاشتراكات",
          Dashboards: "لوحات القيادة",
          Users: "المستخدمين",
          Subscription: "الاشتراك",
          Admin: "مدير",
        },
      };

      function setLanguage(lang) {
        document.documentElement.lang = lang;
        document.documentElement.dir = lang === "ar" ? "rtl" : "ltr";
        document.querySelector(".user-role").textContent =
          translations[lang].Home;
        document.querySelector(".overview-title").textContent =
          translations[lang].Overview;
        document.querySelector(".sidebar-header").textContent =
          translations[lang].Dashboards;
        const navItems = document.querySelectorAll(".sidebar a.nav-item");
        if (navItems.length >= 3) {
          navItems[0].innerHTML =
            '<i class="fas fa-chart-pie"></i> ' + translations[lang].Overview;
          navItems[1].innerHTML =
            '<i class="fas fa-users"></i> ' + translations[lang].Users;
          navItems[2].innerHTML =
            '<i class="fas fa-credit-card"></i> ' +
            translations[lang].Subscription;
        }
        const adminName =
          localStorage.getItem("firstName") || translations[lang].Admin;
        document.querySelector(".admin-label").textContent = adminName;
        languageBtn.textContent = lang === "en" ? "AR" : "EN";
      }

      languageBtn.addEventListener("click", () => {
        currentLang = currentLang === "en" ? "ar" : "en";
        setLanguage(currentLang);
      });

      document.addEventListener("DOMContentLoaded", () => {
        const token = localStorage.getItem("token") || "YOUR_FALLBACK_TOKEN";
        const apiUrl = "http://localhost:3000/stats/dashboard";
        fetch(apiUrl, {
          headers: { Authorization: `Bearer ${token}` },
        })
          .then((response) => {
            if (handleUnauthorized(response)) return;
            return response.json();
          })
          .then((data) => {
            const cards = document.querySelectorAll(".overview-card");
            if (cards.length >= 6) {
              cards[0].querySelector("h5").textContent = `$${data.annualSales}`;
              cards[1].querySelector(
                "h5"
              ).textContent = `$${data.monthlySales}`;
              cards[2].querySelector("h5").textContent = `$${data.dailySales}`;
              cards[3].querySelector("h5").textContent = data.totalUsers;
              cards[4].querySelector("h5").textContent = data.adminUsers;
              cards[5].querySelector("h5").textContent =
                data.totalSubscriptions;
            }
          })
          .catch((err) =>
            console.error("Error fetching dashboard stats:", err)
          );
      });
    </script>
  </body>
</html>
